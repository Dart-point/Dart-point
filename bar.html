<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dart Point – Fiche bar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    :root { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; color-scheme: dark; }
    body { margin:0; background:#05060a; color:#f9fafb; }
    a{color:#7bdcff;text-decoration:none;} a:hover{text-decoration:underline;}

    header{
      position:sticky;top:0;z-index:10;
      backdrop-filter:blur(12px);background:rgba(5,6,10,0.9);
      border-bottom:1px solid rgba(255,255,255,0.05);
    }
    .container{max-width:1000px;margin:0 auto;padding:0 1.5rem;}
    nav{display:flex;justify-content:space-between;align-items:center;padding:0.75rem 0;font-size:0.9rem;}
    .logo{font-weight:700;letter-spacing:0.12em;text-transform:uppercase;font-size:0.9rem;}
    .logo span{border:1px solid rgba(255,255,255,0.3);border-radius:999px;padding:0.1rem 0.4rem;margin-left:0.3rem;font-size:0.7rem;}
    .nav-links a{margin-left:1.2rem;font-size:0.85rem;opacity:0.85;}
    .nav-links a:hover{opacity:1;}

    main{padding:2.5rem 0 3rem;}
    h1{font-size:2rem;margin-bottom:0.2rem;}
    p.lead{max-width:640px;font-size:0.95rem;opacity:0.9;}

    .back{font-size:0.85rem;margin-bottom:0.8rem;display:inline-block;}

    .detail-layout{
      display:grid;grid-template-columns:minmax(0,1.6fr) minmax(0,1.4fr);
      gap:1.5rem;margin-top:1.5rem;
    }
    .card{
      background:rgba(15,23,42,0.96);
      border-radius:1rem;
      border:1px solid rgba(148,163,184,0.5);
      padding:1rem 1.2rem;
      font-size:0.9rem;
    }
    .card h2{font-size:1.1rem;margin-top:0;}

    #map-bar{
      width:100%;height:260px;border-radius:0.9rem;margin-top:0.6rem;
      border:1px solid rgba(148,163,184,0.5);
    }

    .photos-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:0.6rem;
      margin-top:0.8rem;
    }
    .photos-grid img{
      width:100%;height:120px;object-fit:cover;border-radius:0.7rem;
      border:1px solid rgba(148,163,184,0.5);
    }

    .field{margin-bottom:0.6rem;}
    label{display:block;font-size:0.75rem;text-transform:uppercase;letter-spacing:0.08em;opacity:0.8;margin-bottom:0.15rem;}
    input,textarea{
      width:100%;border-radius:0.7rem;border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.95);color:#f9fafb;font-size:0.85rem;
      padding:0.45rem 0.6rem;box-sizing:border-box;
    }
    textarea{min-height:80px;resize:vertical;}
    .btn{
      border-radius:999px;border:none;padding:0.45rem 1.1rem;
      background:linear-gradient(135deg,#38bdf8,#8b5cf6);
      color:#05060a;font-size:0.85rem;font-weight:600;cursor:pointer;
    }

    .comment{border-bottom:1px solid rgba(148,163,184,0.3);padding:0.4rem 0;}
    .comment:last-child{border-bottom:none;}
    .comment strong{font-size:0.85rem;}
    .comment p{margin:0.15rem 0 0.1rem;font-size:0.85rem;}

    .msg{font-size:0.8rem;margin-top:0.3rem;}
    .msg-ok{color:#4ade80;} .msg-error{color:#fb7185;}

    @media(max-width:900px){
      .detail-layout{grid-template-columns:minmax(0,1fr);}
      .nav-links{display:none;}
    }
  </style>
</head>
<body>
<header>
  <div class="container">
    <nav>
      <div class="logo">Dart Point <span>Bêta</span></div>
      <div class="nav-links">
        <a href="index.html">Accueil</a>
        <a href="bars.html">Bars</a>
        <a href="associations.html">Associations</a>
        <a href="shop.html">Shop</a>
      </div>
    </nav>
  </div>
</header>

<main>
  <div class="container">
    <a href="bars.html" class="back">← Retour à la liste des bars</a>

    <h1 id="bar-title">Bar</h1>
    <p class="lead" id="bar-desc"></p>

    <div class="detail-layout">
      <section class="card">
        <h2>Infos pratiques</h2>
        <p><strong>Ville :</strong> <span id="bar-city"></span></p>
        <p><strong>Adresse :</strong> <span id="bar-address"></span></p>
        <p><strong>Type de cibles :</strong> <span id="bar-type"></span></p>
      </section>

      <section class="card">
        <h2>Localisation</h2>
        <div id="map-bar"></div>
      </section>
    </div>

    <section class="card" style="margin-top:1.5rem;">
      <h2>Photos</h2>
      <div class="photos-grid" id="photo-grid"></div>

      <form id="form-photo" style="margin-top:0.8rem;">
        <div class="field">
          <label for="photo-url">Ajouter une photo (URL)</label>
          <input id="photo-url" placeholder="https://…">
        </div>
        <button class="btn" type="submit">Ajouter la photo</button>
        <div class="msg" id="msg-photo"></div>
      </form>
    </section>

    <section class="card" style="margin-top:1.5rem;">
      <h2>Commentaires des joueurs</h2>
      <div id="comment-list"></div>

      <form id="form-comment" style="margin-top:0.8rem;">
        <div class="field">
          <label for="pseudo">Pseudo</label>
          <input id="pseudo" placeholder="Ton nom ou pseudo">
        </div>
        <div class="field">
          <label for="comment">Commentaire</label>
          <textarea id="comment" placeholder="Ambiance, qualité des cibles, accueil…"></textarea>
        </div>
        <button class="btn" type="submit">Publier le commentaire</button>
        <div class="msg" id="msg-comment"></div>
      </form>
    </section>
  </div>
</main>

<script>
  // Même base de données que dans bars.html
  const bars = [
    {
      id: "relais-halles",
      name: "Le Relais des Halles",
      city: "Bayonne",
      address: "19 Rue Guilhamin, Bayonne",
      type: "Traditionnelles (pointes acier)",
      desc: "Bar convivial avec cibles traditionnelles.",
      coords: [43.4929, -1.4748],
      images: [
        "https://images.pexels.com/photos/260922/pexels-photo-260922.jpeg",
        "https://images.pexels.com/photos/274192/pexels-photo-274192.jpeg"
      ]
    },
    {
      id: "black-pig",
      name: "The Black Pig",
      city: "Bayonne",
      address: "21 Quai Amiral Jaureguiberry, Bayonne",
      type: "Traditionnelles (pointes acier)",
      desc: "Ambiance pub anglais, soirées darts et musique.",
      coords: [43.4927, -1.4745],
      images: [
        "https://images.pexels.com/photos/338713/pexels-photo-338713.jpeg"
      ]
    },
    {
      id: "petrolette",
      name: "La Pétrolette",
      city: "Bayonne",
      address: "31 Rue des Cordeliers, Bayonne",
      type: "Traditionnelles (pointes acier)",
      desc: "Bar animé, musique live et fléchettes.",
      coords: [43.4932, -1.4779],
      images: [
        "https://images.pexels.com/photos/602750/pexels-photo-602750.jpeg"
      ]
    },
    {
      id: "h2biere",
      name: "H2Bière",
      city: "Cambo-les-Bains",
      address: "Centre-ville, 64250 Cambo-les-Bains",
      type: "Traditionnelles (pointes acier)",
      desc: "Bar à bières avec cibles traditionnelles et ambiance locale.",
      coords: [43.3589, -1.4003],
      images: [
        "https://images.pexels.com/photos/1267340/pexels-photo-1267340.jpeg"
      ]
    }
  ];

  // Récupérer l'id dans l'URL
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');

  const bar = bars.find(b => b.id === id);

  const titleEl = document.getElementById('bar-title');
  const descEl = document.getElementById('bar-desc');
  const cityEl = document.getElementById('bar-city');
  const addrEl = document.getElementById('bar-address');
  const typeEl = document.getElementById('bar-type');
  const photoGrid = document.getElementById('photo-grid');
  const commentList = document.getElementById('comment-list');

  if (!bar) {
    titleEl.textContent = "Bar introuvable";
    descEl.textContent = "La fiche demandée n’existe pas. Vérifie le lien ou retourne à la liste des bars.";
  } else {
    titleEl.textContent = `${bar.city} – ${bar.name}`;
    descEl.textContent = bar.desc;
    cityEl.textContent = bar.city;
    addrEl.textContent = bar.address;
    typeEl.textContent = bar.type;

    // Carte
    if (bar.coords) {
      const map = L.map('map-bar').setView(bar.coords, 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap'
      }).addTo(map);
      L.marker(bar.coords).addTo(map).bindPopup(bar.name);
    } else {
      document.getElementById('map-bar').innerHTML = "Localisation à préciser.";
    }

    // Photos initiales
    function renderPhotos() {
      photoGrid.innerHTML = "";
      (bar.images || []).forEach(url => {
        const img = document.createElement('img');
        img.src = url;
        img.alt = bar.name;
        photoGrid.appendChild(img);
      });
    }
    renderPhotos();

    // Ajout de photo (URL)
    const formPhoto = document.getElementById('form-photo');
    const photoUrlInput = document.getElementById('photo-url');
    const msgPhoto = document.getElementById('msg-photo');

    formPhoto.addEventListener('submit', (e) => {
      e.preventDefault();
      const url = photoUrlInput.value.trim();
      if (!url) {
        msgPhoto.textContent = "Merci d’indiquer une URL de photo.";
        msgPhoto.className = "msg msg-error";
        return;
      }
      bar.images = bar.images || [];
      bar.images.push(url);
      renderPhotos();
      msgPhoto.textContent = "Photo ajoutée (démo, non enregistrée définitivement).";
      msgPhoto.className = "msg msg-ok";
      photoUrlInput.value = "";
    });

    // Commentaires (en mémoire uniquement)
    const comments = [];
    const formComment = document.getElementById('form-comment');
    const pseudoInput = document.getElementById('pseudo');
    const commentInput = document.getElementById('comment');
    const msgComment = document.getElementById('msg-comment');

    function renderComments() {
      commentList.innerHTML = "";
      if (comments.length === 0) {
        commentList.innerHTML = "<p>Aucun commentaire pour l’instant.</p>";
        return;
      }
      comments.forEach(c => {
        const div = document.createElement('div');
        div.className = "comment";
        div.innerHTML = `<strong>${c.pseudo}</strong><p>${c.text}</p>`;
        commentList.appendChild(div);
      });
    }
    renderComments();

    formComment.addEventListener('submit', (e) => {
      e.preventDefault();
      const pseudo = pseudoInput.value.trim() || "Anonyme";
      const text = commentInput.value.trim();
      if (!text) {
        msgComment.textContent = "Merci d’écrire un commentaire.";
        msgComment.className = "msg msg-error";
        return;
      }
      comments.push({ pseudo, text });
      renderComments();
      msgComment.textContent = "Commentaire ajouté (démo, non enregistré définitivement).";
      msgComment.className = "msg msg-ok";
      commentInput.value = "";
    });
  }
</script>
</body>
</html>
